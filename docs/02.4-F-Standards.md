# MOD 02.4-F – Advanced Standards (Events / Providers / Pre-Contract)

Acest document definește standardele „avansate” care se aplică transversal pe
serviciile: auth-service, users-service, events-service, providers-service,
notifications-service și pe UI (eventure-ui).

Scop: 
- robustețe (consistență, rollback, audit)
- claritate în modelarea domeniului
- pregătire pentru MOD 03 (Contracts & Payments, finanțe critice)
- observabilitate (înțelegi ce se întâmplă)
- loc clar pentru extensii AI și feature flags.

---

## 1. Modelare domeniu (DDD-lite)

### 1.1 Agregate principale

- **Event** (events-service)
  - Proprietar: client (userId din users-service)
  - Children:
    - EventTask
    - EventNeed
    - EventInvitation
    - EventOffer
    - EventProviderAssignment
    - EventParticipant
    - EventBrief
    - EventGuestbookEntry / EventGuestbookToken

- **Provider** (providers-service)
  - Proprietar: user cu rol PROVIDER
  - Children:
    - ProviderService
    - ProviderPackage
    - ProviderGroup (+ GroupMember)
    - ProviderAvailability

- **Notification** (notifications-service)
  - Legată de authUserId, cu data/meta referențiale (eventId, offerId, etc.)

### 1.2 Versionare

- Entitățile critice au `version Int @default(1)`:
  - Event
  - EventNeed
  - EventOffer (DEJA implementat)
  - EventProviderAssignment
- Orice update semnificativ incrementează `version`.
- Versionarea este folosită:
  - pentru optimistic locking
  - pentru a decide dacă anumite efecte (notificări, recalculări) se mai aplică.

---

## 2. Evenimente de domeniu & Outbox

### 2.1 Naming

Evenimentele de domeniu publicate pe NATS urmează formatul:

- `events.precontract.offer.created`
- `events.precontract.offer.updated`
- `events.precontract.offer.accepted`
- `events.precontract.invitation.created`
- `events.precontract.assignment.created`
- `events.precontract.assignment.updated`

Payload minim:

```json
{
  "eventId": "string",
  "offerId": "string",
  "invitationId": "string | null",
  "providerId": "string | null",
  "providerGroupId": "string | null",
  "needId": "string | null",
  "version": 2,
  "meta": { "source": "events-service" }
}
